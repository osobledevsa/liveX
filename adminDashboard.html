<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - LiveX</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --light-azure: #d2e4ee;
            --dull-orange: #e67e22;
            --electric-blue: #00a8ff;
            --neon-pink: #ff2e63;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background-color: #f8fafc;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #d2e4ee 0%, #e8f2f7 50%, #d2e4ee 100%);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--dull-orange) 0%, #ff8c42 100%);
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(230, 126, 34, 0.3);
        }
        
        .btn-secondary {
            background: transparent;
            border: 2px solid var(--electric-blue);
            color: var(--electric-blue);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(0, 168, 255, 0.1);
            transform: translateY(-3px);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
            color: white;
            transition: all 0.3s ease;
        }
        
        .card-shadow {
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1), 0 5px 15px -5px rgba(0, 0, 0, 0.05);
            border-radius: 16px;
        }
        
        .input-focus {
            transition: all 0.3s ease;
            border: 1px solid #ddd;
            padding: 12px 16px;
            border-radius: 8px;
            width: 100%;
        }
        
        .input-focus:focus {
            outline: none;
            border-color: var(--electric-blue);
            box-shadow: 0 0 0 3px rgba(0, 168, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-active {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-completed {
            background-color: #10b981;
            color: #065f46;
        }
        
        .status-rejected {
            background-color: #fca5a5;
            color: #991b1b;
        }
        
        .status-paid {
            background-color: #059669;
            color: white;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-600">Loading admin dashboard...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="w-full py-4 px-6 bg-white shadow-sm">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center">
                <img src="assets/images/logo.jpg" alt="LiveX Logo" class="h-10 w-10 rounded-full mr-3">
                <span class="text-xl font-bold text-gray-800">LiveX</span>
                <div class="ml-3 flex items-center">
                    <i class="fas fa-shield-alt text-red-600 text-lg"></i>
                    <span class="text-lg font-semibold text-gray-800">Admin</span>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <button onclick="handleLogout()" class="px-4 py-2 rounded-full btn-secondary">
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-7xl mx-auto">
            <!-- Stats Section -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                            <i class="fas fa-users text-lg"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Total Campaigns</p>
                            <h3 id="total-campaigns" class="text-2xl font-bold text-gray-800">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                            <i class="fas fa-check-circle text-lg"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Active Campaigns</p>
                            <h3 id="active-campaigns" class="text-2xl font-bold text-gray-800">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                            <i class="fas fa-clock text-lg"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Pending Campaigns</p>
                            <h3 id="pending-campaigns" class="text-2xl font-bold text-gray-800">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                            <i class="fas fa-dollar-sign text-lg"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Total Revenue</p>
                            <h3 id="total-revenue" class="text-2xl font-bold text-gray-800">Ksh 0</h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard Content -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Campaign Management -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl card-shadow overflow-hidden">
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <h2 class="text-2xl font-bold text-gray-800">Campaign Management</h2>
                                <div class="flex items-center space-x-4">
                                    <button onclick="switchTab('pending')" class="tab-button active py-4 font-medium text-gray-700" data-tab="pending">
                                        Pending
                                    </button>
                                    <button onclick="switchTab('active')" class="tab-button py-4 font-medium text-gray-700" data-tab="active">
                                        Active
                                    </button>
                                    <button onclick="switchTab('all')" class="tab-button py-4 font-medium text-gray-700" data-tab="all">
                                        All
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Campaign Lists -->
                        <div id="pending-campaigns" class="p-6 grid gap-4">
                            <!-- Pending campaigns will be loaded here -->
                        </div>
                        
                        <div id="active-campaigns" class="p-6 grid gap-4 hidden">
                            <!-- Active campaigns will be loaded here -->
                        </div>
                        
                        <div id="all-campaigns" class="p-6 grid gap-4 hidden">
                            <!-- All campaigns will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Payment Management -->
                <div>
                    <div class="bg-white rounded-2xl card-shadow overflow-hidden">
                        <div class="p-6 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <h2 class="text-2xl font-bold text-gray-800">Payment Management</h2>
                                <div class="flex items-center space-x-4">
                                    <button onclick="switchPaymentTab('pending')" class="tab-button active py-4 font-medium text-gray-700" data-tab="pending">
                                        Pending Payments
                                    </button>
                                    <button onclick="switchPaymentTab('approved')" class="tab-button py-4 font-medium text-gray-700" data-tab="approved">
                                        Approved
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Lists -->
                        <div id="pending-payments" class="p-6 grid gap-4">
                            <!-- Pending payments will be loaded here -->
                        </div>
                        
                        <div id="approved-payments" class="p-6 grid gap-4 hidden">
                            <!-- Approved payments will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Campaign Details Modal -->
    <div id="campaign-modal" class="modal">
        <div class="modal-content">
            <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 id="modal-campaign-name" class="text-2xl font-bold text-gray-800">Campaign Name</h2>
                        <p id="modal-campaign-brand" class="text-gray-600">Brand Name</p>
                    </div>
                    <button onclick="closeModal()" class="p-3 hover:bg-gray-100 rounded-full transition-colors">
                        <i class="fas fa-times text-gray-600"></i>
                    </button>
                </div>

                <div id="modal-content">
                    <!-- Modal content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Details Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 id="payment-modal-title" class="text-2xl font-bold text-gray-800">Payment Details</h2>
                    </div>
                    <button onclick="closePaymentModal()" class="p-3 hover:bg-gray-100 rounded-full transition-colors">
                        <i class="fas fa-times text-gray-600"></i>
                    </button>
                </div>

                <div id="payment-modal-content">
                    <!-- Payment modal content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBT3OWo_bdJtcnmqVVX_tNndSCe9gyEA_k",
            authDomain: "livex-b1c25.firebaseapp.com",
            projectId: "livex-b1c25",
            storageBucket: "livex-b1c25.firebasestorage.app",
            messagingSenderId: "1025075596453",
            appId: "1:1025075596453:web:686be2ebffa5c0f723114c",
            measurementId: "G-GNQLPMEJWX"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let allCampaigns = [];
        let currentTab = 'pending';
        let selectedCampaign = null;
        let selectedPayment = null;

        // Check authentication on page load
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadCampaigns();
                document.getElementById('loading-screen').style.display = 'none';
            } else {
                window.location.href = 'login.html';
            }
        });

        // Load campaigns
        async function loadCampaigns() {
            try {
                const snapshot = await db.collection('campaigns')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                allCampaigns = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                displayCampaigns();
                updateStats();
            } catch (error) {
                console.error('Error loading campaigns:', error);
            }
        }

        // Update stats
        function updateStats() {
            const totalCampaigns = allCampaigns.length;
            const activeCampaigns = allCampaigns.filter(c => c.status === 'active').length;
            const pendingCampaigns = allCampaigns.filter(c => c.status === 'pending').length;
            const completedCampaigns = allCampaigns.filter(c => c.status === 'completed').length;
            
            document.getElementById('total-campaigns').textContent = totalCampaigns;
            document.getElementById('active-campaigns').textContent = activeCampaigns;
            document.getElementById('pending-campaigns').textContent = pendingCampaigns;
            document.getElementById('completed-campaigns').textContent = completedCampaigns;
            
            // Calculate total revenue
            const totalRevenue = completedCampaigns.reduce((sum, c) => sum + (c.totalCost || 0), 0);
            document.getElementById('total-revenue').textContent = `Ksh ${totalRevenue.toLocaleString()}`;
        }

        // Display campaigns
        function displayCampaigns() {
            const pendingContainer = document.getElementById('pending-campaigns');
            const activeContainer = document.getElementById('active-campaigns');
            const allContainer = document.getElementById('all-campaigns');
            
            // Clear existing content
            pendingContainer.innerHTML = '';
            activeContainer.innerHTML = '';
            allContainer.innerHTML = '';
            
            const pendingCampaigns = allCampaigns.filter(c => c.status === 'pending');
            const activeCampaigns = allCampaigns.filter(c => c.status === 'active');
            const allCampaignsList = [...pendingCampaigns, ...activeCampaigns];
            
            // Display pending campaigns
            if (pendingCampaigns.length === 0) {
                pendingContainer.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-clock text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">No pending campaigns</p>
                    </div>
                `;
            } else {
                pendingCampaigns.forEach(campaign => {
                    pendingContainer.appendChild(createCampaignCard(campaign, 'pending'));
                });
            }
            
            // Display active campaigns
            if (activeCampaigns.length === 0) {
                activeContainer.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-check-circle text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">No active campaigns</p>
                    </div>
                `;
            } else {
                activeCampaigns.forEach(campaign => {
                    activeContainer.appendChild(createCampaignCard(campaign, 'active'));
                });
            }
            
            // Display all campaigns
            if (allCampaignsList.length === 0) {
                allContainer.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-list text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">No campaigns found</p>
                    </div>
                `;
            } else {
                allCampaignsList.forEach(campaign => {
                    allContainer.appendChild(createCampaignCard(campaign, 'all'));
                });
            }
        }

        // Create campaign card
        function createCampaignCard(campaign, type) {
            const card = document.createElement('div');
            card.className = 'bg-white p-5 rounded-lg border border-gray-200 hover:shadow-md transition-all duration-300';
            
            const statusClass = type === 'pending' ? 'status-pending' : 
                               type === 'active' ? 'status-active' : 
                               type === 'completed' ? 'status-completed' : 
                               type === 'rejected' ? 'status-rejected' : 'status-paid';
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold text-gray-800 mb-1">${campaign.name}</h3>
                        <p class="text-gray-600 text-sm mb-2">by ${campaign.brand}</p>
                        <div class="flex items-center space-x-2 mb-3">
                            <span class="status-badge ${statusClass}">${campaign.status.charAt(0).toUpperCase() + campaign.status.slice(1)}</span>
                            <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">
                                ${campaign.spotsAvailable || 0} spots left
                            </span>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-orange-600">Ksh ${(campaign.totalCost || 0).toLocaleString()}</p>
                        <p class="text-xs text-gray-500">Total Cost</p>
                    </div>
                </div>
                
                <div class="flex justify-between text-sm text-gray-600 mb-4">
                    <div class="flex items-center space-x-1">
                        <i class="fas fa-bullseye text-blue-500"></i>
                        <span>${campaign.goal}</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <i class="fas fa-calendar text-green-500"></i>
                        <span>${campaign.deadline || '7 days'}</span>
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="viewCampaignDetails('${campaign.id}')" class="btn-secondary px-3 py-2 rounded-lg text-sm">
                        <i class="fas fa-eye mr-1"></i> View Details
                    </button>
                    ${type === 'pending' ? `
                        <button onclick="approveCampaign('${campaign.id}')" class="btn-success px-3 py-2 rounded-lg text-sm ml-2">
                            <i class="fas fa-check mr-1"></i> Approve
                        </button>
                        <button onclick="rejectCampaign('${campaign.id}')" class="btn-danger px-3 py-2 rounded-lg text-sm">
                            <i class="fas fa-times mr-1"></i> Reject
                        </button>
                    ` : ''}
                </div>
            `;
            
            return card;
        }

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide content
            document.getElementById('pending-campaigns').classList.toggle('hidden', tab !== 'pending');
            document.getElementById('active-campaigns').classList.toggle('hidden', tab !== 'active');
            document.getElementById('all-campaigns').classList.toggle('hidden', tab !== 'all');
        }

        // View campaign details
        function viewCampaignDetails(campaignId) {
            selectedCampaign = allCampaigns.find(c => c.id === campaignId);
            if (!selectedCampaign) return;
            
            const modal = document.getElementById('campaign-modal');
            const modalContent = document.getElementById('modal-content');
            
            document.getElementById('modal-campaign-name').textContent = selectedCampaign.name;
            document.getElementById('modal-campaign-brand').textContent = selectedCampaign.brand;
            
            const modalContentHTML = `
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Campaign Details</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-600">Campaign Name</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.name}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Brand Name</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.brand}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-600">Campaign Goal</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.goal}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-600">Category</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.category}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-600">Total Spots</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.totalSpots}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-600">Spots Available</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.spotsAvailable}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-600">Total Cost</p>
                            <p class="font-medium text-gray-800">Ksh ${(selectedCampaign.totalCost || 0).toLocaleString()}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-600">Status</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.status.charAt(0).toUpperCase() + selectedCampaign.status.slice(1)}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-600">Created</p>
                            <p class="font-medium text-gray-800">${new Date(selectedCampaign.createdAt?.toDate()).toLocaleDateString()}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-600">Instructions</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.instructions}</p>
                        </div>
                    </div>
                    
                    ${selectedCampaign.caption ? `
                        <div>
                            <p class="text-sm text-gray-600">Caption</p>
                            <p class="font-medium text-gray-800">${selectedCampaign.caption}</p>
                        </div>
                    ` : ''}
                    
                    ${selectedCampaign.hashtags && selectedCampaign.hashtags.length > 0 ? `
                        <div>
                            <p class="text-sm text-gray-600">Hashtags</p>
                            <div class="flex flex-wrap gap-2">
                                ${selectedCampaign.hashtags.map(tag => `
                                    <span class="inline-block bg-gray-100 px-3 py-1 rounded-full text-sm">#${tag.replace('#', '')}</span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${selectedCampaign.mentions && selectedCampaign.mentions.length > 0 ? `
                        <div>
                            <p class="text-sm text-gray-600">Mentions</p>
                            <div class="flex flex-wrap gap-2">
                                ${selectedCampaign.mentions.map(mention => `
                                    <span class="inline-block bg-gray-100 px-3 py-1 rounded-full text-sm">@${mention.replace('@', '')}</span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            modalContent.innerHTML = modalContentHTML;
            modal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('campaign-modal').classList.remove('active');
        }

        // Approve campaign
        async function approveCampaign(campaignId) {
            if (!confirm('Are you sure you want to approve this campaign? This will make it available to influencers.')) {
                return;
            }
            
            try {
                await db.collection('campaigns').doc(campaignId).update({
                    status: 'active'
                });
                
                // Update local data
                const campaign = allCampaigns.find(c => c.id === campaignId);
                if (campaign) {
                    campaign.status = 'active';
                }
                
                // Refresh display
                displayCampaigns();
                updateStats();
                
                alert('Campaign approved successfully!');
                closeModal();
            } catch (error) {
                console.error('Error approving campaign:', error);
                alert('Error approving campaign: ' + error.message);
            }
        }

        // Reject campaign
        async function rejectCampaign(campaignId) {
            if (!confirm('Are you sure you want to reject this campaign? This will permanently remove it from the platform.')) {
                return;
            }
            
            try {
                await db.collection('campaigns').doc(campaignId).update({
                    status: 'rejected'
                });
                
                // Update local data
                const campaign = allCampaigns.find(c => c.id === campaignId);
                if (campaign) {
                    campaign.status = 'rejected';
                }
                
                // Refresh display
                displayCampaigns();
                updateStats();
                
                alert('Campaign rejected successfully!');
                closeModal();
            } catch (error) {
                console.error('Error rejecting campaign:', error);
                alert('Error rejecting campaign: ' + error.message);
            }
        }

        // Switch payment tabs
        function switchPaymentTab(tab) {
            const pendingContainer = document.getElementById('pending-payments');
            const approvedContainer = document.getElementById('approved-payments');
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide content
            pendingContainer.classList.toggle('hidden', tab !== 'pending');
            approvedContainer.classList.toggle('hidden', tab !== 'approved');
        }

        // Display payments
        function displayPayments() {
            const pendingContainer = document.getElementById('pending-payments');
            const approvedContainer = document.getElementById('approved-payments');
            
            // Clear existing content
            pendingContainer.innerHTML = '';
            approvedContainer.innerHTML = '';
            
            const allSubmissions = [];
            allCampaigns.forEach(campaign => {
                if (campaign.submissions) {
                    Object.values(campaign.submissions).forEach(submission => {
                        allSubmissions.push({
                            campaignId: campaign.id,
                            campaignName: campaign.name,
                            influencerName: submission.influencerName,
                            influencerInstagram: submission.influencerInstagram,
                            amount: getPaymentAmount(campaign.category),
                            status: submission.status,
                            submissionDate: submission.submissionDate,
                            paymentDate: submission.paymentDate
                        });
                    });
                }
            });
            
            // Display pending payments
            if (allSubmissions.length === 0) {
                pendingContainer.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-clock text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">No pending payments</p>
                    </div>
                `;
            } else {
                allSubmissions.forEach(submission => {
                    pendingContainer.appendChild(createPaymentCard(submission));
                });
            }
            
            // Display approved payments
            if (allSubmissions.length === 0) {
                approvedContainer.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-check-circle text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">No approved payments</p>
                    </div>
                `;
            } else {
                allSubmissions.forEach(submission => {
                    approvedContainer.appendChild(createPaymentCard(submission));
                });
            }
        }

        // Create payment card
        function createPaymentCard(submission) {
            const card = document.createElement('div');
            card.className = 'bg-white p-4 rounded-lg border border-gray-200 hover:shadow-md transition-all duration-300';
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-800">${submission.campaignName}</h4>
                        <p class="text-sm text-gray-600">by ${submission.influencerName}</p>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="status-badge ${submission.status === 'pending_payment' ? 'status-pending' : 'status-paid'}">${submission.status === 'pending_payment' ? 'Pending Payment' : 'Paid'}</span>
                            <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${submission.submissionDate}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-green-600">Ksh ${submission.amount.toLocaleString()}</p>
                        <p class="text-xs text-gray-500">Payment Amount</p>
                    </div>
                </div>
                
                <div class="flex justify-between text-sm text-gray-600 mb-4">
                    <div class="flex items-center space-x-1">
                        <i class="fab fa-instagram text-pink-600"></i>
                        <a href="${submission.influencerInstagram}" target="_blank" class="text-blue-600 hover:text-blue-800">${submission.influencerInstagram}</a>
                    </div>
                    <div class="flex items-center space-x-1">
                        <i class="fas fa-user text-gray-600"></i>
                        <span>${submission.influencerName}</span>
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="approvePayment('${submission.campaignId}', '${submission.influencerId}')" class="btn-success px-3 py-2 rounded-lg text-sm">
                        <i class="fas fa-check mr-1"></i> Approve Payment
                    </button>
                </div>
            `;
            
            return card;
        }

        // Approve payment
        async function approvePayment(campaignId, influencerId) {
            if (!confirm('Are you sure you want to approve this payment?')) {
                return;
            }
            
            try {
                // Update submission status
                await db.collection('campaigns').doc(campaignId).collection('submissions')
                    .where('influencerId', '==', influencerId)
                    .get()
                    .then((querySnapshot) => {
                        querySnapshot.forEach((doc) => {
                            return db.collection('campaigns').doc(campaignId).collection('submissions').doc(doc.id).update({
                                status: 'paid'
                            });
                        });
                    });
                
                // Update campaign status if all payments are approved
                const campaignDoc = await db.collection('campaigns').doc(campaignId).get();
                const campaignData = campaignDoc.data();
                const submissionsSnapshot = await db.collection('campaigns').doc(campaignId).collection('submissions').get();
                
                const allPaid = submissionsSnapshot.docs.every(doc => doc.data().status === 'paid');
                
                if (allPaid) {
                    await db.collection('campaigns').doc(campaignId).update({
                        status: 'completed'
                    });
                }
                
                // Refresh display
                displayPayments();
                updateStats();
                
                alert('Payment approved successfully!');
            } catch (error) {
                console.error('Error approving payment:', error);
                alert('Error approving payment: ' + error.message);
            }
        }

        // Close payment modal
        function closePaymentModal() {
            document.getElementById('payment-modal').classList.remove('active');
        }

        // Get payment amount based on category
        function getPaymentAmount(category) {
            switch (category) {
                case 'Nano': return 1000;
                case 'Micro': return 4000;
                case 'Macro': return 7000;
                case 'Mega': return 15000;
                default: return 0;
            }
        }

        // Handle logout
        async function handleLogout() {
            try {
                await auth.signOut();
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Error logging out:', error);
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>